{% extends "base.html" %} 
{% load static %} 
{% load helpers %} 
{% block content %}
<div class="dashboard-wrapper">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Observability Dashboard - Vulnerability Score</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.7/tippy.umd.min.js"></script>
  
  <style>
    #content-wrapper {
      padding: 0 !important;
      margin: 0 !important;
      position: relative !important;
    }
    
    .dashboard-wrapper {
      position: absolute;
      top: 0;
      left: 230px; /* Match the width of your sidebar */
      right: 0;
      padding: 15px;
      z-index: 10;
      background-color: #f5f7fa;
      min-height: 100vh;
    }
    
    /* Card styles */
    .dashboard-card {
      background-color: #ffffff;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    /* Dashboard header styles */
    .dashboard-header {
      background-color: #2c3e50;
      color: white;
      padding: 15px 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .dashboard-header h2 {
      margin: 0;
      font-size: 1.5rem;
    }
    
    .close-button {
      background: transparent;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }
    
    /* Stats styles */
    .overview-stats {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .stats-container {
      display: flex;
      margin-left: 20px;
    }
    
    .stat-item {
      margin-right: 40px;
      text-align: center;
    }
    
    .stat-item:last-child {
      margin-right: 0;
    }
    
    .stat-label {
      font-size: 2rem;
      color: #546e7a;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 6rem;
      font-weight: bold;
    }
    
    .stat-value.patched {
      color: #2ecc71;
    }
    
    .stat-value.vulnerable {
      color: #e74c3c;
    }
    
    .stat-value.critical {
      color: #e74c3c;
    }
    
    .stat-value.total {
      color: #34495e;
    }
    
    /* Section header styles */
    .section-header {
      background-color: #2c3e50;
      color: white;
      padding: 12px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }
    
    /* Vulnerability categories styles */
    .vulnerability-category {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .category-name {
      width: 230px;
    }
    
    .category-bar {
      flex-grow: 1;
      height: 10px;
      background-color: #ecf0f1;
      border-radius: 5px;
      position: relative;
      margin: 0 15px;
    }
    
    .category-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background-color: #e74c3c;
      border-radius: 5px;
    }
    
    .category-percentage {
      width: 40px;
      text-align: right;
    }
    
    /* Action header styles */
    .action-header {
      background-color: #e74c3c;
      color: white;
      padding: 12px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-size: 1.2rem;
      text-align: center;
    }
    
    /* Table styles */
    .priority-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .priority-table th {
      padding: 8px 12px;
      text-align: left;
      color: #7f8c8d;
      font-weight: normal;
      border-bottom: 1px solid #ecf0f1;
    }
    
    .priority-table td {
      padding: 8px 12px;
      border-bottom: 1px solid #ecf0f1;
    }
    
    .cve-id {
      color: #e74c3c;
    }
    
    /* Remediation styles */
    .remediation-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .donut-charts {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-bottom: 15px;
    }
    
    .donut-container {
      position: relative;
      width: 120px;
      height: 120px;
    }
    
    .chart-label {
      text-align: center;
      font-size: 0.8rem;
      color: #7f8c8d;
      margin-top: 5px;
    }
    
    .progress-bar-container {
      width: 90%;
      background-color: #f39c12;
      height: 25px;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
      margin-bottom: 10px;
    }
    
    .target-text {
      color: #34495e;
      text-align: center;
      font-size: 0.9rem;
    }
  </style>

  <!-- Dashboard header -->
  <div class="dashboard-header">
    <h2>Network Observability Dashboard - Vulnerability Score</h2>
    <button class="close-button">×</button>
  </div>
  
  <!-- Vulnerability Overview Section -->
  <div class="dashboard-card">
    <h3>Vulnerability Overview</h3>
    <div class="overview-stats">
      <div>
        <canvas id="overviewChart" width="200" height="200"></canvas>
      </div>
      <div class="stats-container">
        <div class="stat-item">
          <div class="stat-label">Total Devices</div>
          <div class="stat-value total">659</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Patched</div>
          <div class="stat-value patched">613</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Vulnerable</div>
          <div class="stat-value vulnerable">46</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Critical Vulnerabilities</div>
          <div class="stat-value critical">12</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Vulnerability Trend Section -->
  <div class="section-header">
    Vulnerability Trend (Last 30 Days)
  </div>
  <div class="dashboard-card">
    <canvas id="trendChart" height="100"></canvas>
  </div>
  
  <!-- Vulnerability Categories Section -->
  <div class="section-header">
    Vulnerability Categories
  </div>
  <div class="dashboard-card">
    <div class="vulnerability-category">
      <div class="category-name">OS Vulnerabilities</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 5%;"></div>
      </div>
      <div class="category-percentage">5%</div>
    </div>
    <div class="vulnerability-category">
      <div class="category-name">Firmware Outdated</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 9%;"></div>
      </div>
      <div class="category-percentage">9%</div>
    </div>
    <div class="vulnerability-category">
      <div class="category-name">Security Protocol Gaps</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 8%;"></div>
      </div>
      <div class="category-percentage">8%</div>
    </div>
    <div class="vulnerability-category">
      <div class="category-name">Access Control Issues</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 3%;"></div>
      </div>
      <div class="category-percentage">3%</div>
    </div>
    <div class="vulnerability-category">
      <div class="category-name">Authentication Vulnerabilities</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 5%;"></div>
      </div>
      <div class="category-percentage">5%</div>
    </div>
    <div class="vulnerability-category">
      <div class="category-name">Encryption Weakness</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 4%;"></div>
      </div>
      <div class="category-percentage">4%</div>
    </div>
    <div class="vulnerability-category">
      <div class="category-name">Network Protocol Flaws</div>
      <div class="category-bar">
        <div class="category-bar-fill" style="width: 2%;"></div>
      </div>
      <div class="category-percentage">2%</div>
    </div>
  </div>
  
  <!-- Critical Vulnerabilities Section -->
  <div class="action-header">
    Critical Vulnerabilities Requiring Immediate Action
  </div>
  
  <div class="row">
    <div class="col-md-6">
      <div class="dashboard-card">
        <h5>High Priority (CVSS Score ≥ 9.0)</h5>
        <table class="priority-table">
          <thead>
            <tr>
              <th>CVE ID</th>
              <th>Affected Devices</th>
              <th>CVSS Score</th>
              <th>Age</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="cve-id">CVE-2024-34728</td>
              <td>7 Routers</td>
              <td>9.8</td>
              <td>3 days</td>
            </tr>
            <tr>
              <td class="cve-id">CVE-2024-29351</td>
              <td>4 Switches</td>
              <td>9.6</td>
              <td>5 days</td>
            </tr>
            <tr>
              <td class="cve-id">CVE-2023-47892</td>
              <td>3 Firewalls</td>
              <td>9.2</td>
              <td>12 days</td>
            </tr>
            <tr>
              <td class="cve-id">CVE-2024-31043</td>
              <td>5 Access Points</td>
              <td>9.1</td>
              <td>7 days</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="dashboard-card">
        <h5>Remediation Progress</h5>
        <div class="remediation-container">
          <div class="donut-charts">
            <div>
              <div class="donut-container">
                <canvas id="criticalChart" width="120" height="120"></canvas>
              </div>
              <div class="chart-label">Critical Issues</div>
            </div>
            <div>
              <div class="donut-container">
                <canvas id="allVulnerabilitiesChart" width="120" height="120"></canvas>
              </div>
              <div class="chart-label">All Vulnerabilities</div>
            </div>
          </div>
          <div class="progress-bar-container">
            <!-- Progress bar will be rendered by JavaScript -->
          </div>
          <div class="target-text">Remediation Target: 100% critical within 14 days</div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Overview Pie Chart

    document.querySelector('.close-button').addEventListener('click', function() {
        window.location.href = "/cio";
    });
    
    const overviewCtx = document.getElementById('overviewChart').getContext('2d');
    const overviewChart = new Chart(overviewCtx, {
      type: 'pie',
      data: {
        labels: ['Patched', 'Vulnerable'],
        datasets: [{
          data: [613, 46],
          backgroundColor: ['#2ecc71', '#e74c3c'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
    
    // Trend Line Chart
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    const trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
        labels: ['Jan 28', 'Feb 7', 'Feb 17', 'Feb 27'],
        datasets: [
          {
            label: 'Critical',
            data: [49, 36, 20, 32],
            borderColor: '#e74c3c',
            tension: 0.3,
            fill: false
          },
          {
            label: 'High',
            data: [35, 23, 26, 32],
            borderColor: '#f39c12',
            tension: 0.3,
            fill: false
          },
          {
            label: 'Medium',
            data: [22, 10, 15, 24],
            borderColor: '#3498db',
            tension: 0.3,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            align: 'start',
            labels: {
              boxWidth: 12,
              usePointStyle: true,
              pointStyle: 'rect'
            }
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            grid: {
              display: false
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });
    
    // Critical Issues Donut Chart
    const criticalCtx = document.getElementById('criticalChart').getContext('2d');
    const criticalChart = new Chart(criticalCtx, {
      type: 'doughnut',
      data: {
        labels: ['Resolved', 'Pending'],
        datasets: [{
          data: [46, 54],
          backgroundColor: ['#2ecc71', '#e74c3c'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        cutout: '70%',
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.label + ': ' + context.raw + '%';
              }
            }
          }
        }
      }
    });
    
    // All Vulnerabilities Donut Chart
    const allVulnerabilitiesCtx = document.getElementById('allVulnerabilitiesChart').getContext('2d');
    const allVulnerabilitiesChart = new Chart(allVulnerabilitiesCtx, {
      type: 'doughnut',
      data: {
        labels: ['Resolved', 'In Progress', 'Pending'],
        datasets: [{
          data: [71, 18, 11],
          backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        cutout: '70%',
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.label + ': ' + context.raw + '%';
              }
            }
          }
        }
      }
    });
  </script>
</div>
{% endblock %}